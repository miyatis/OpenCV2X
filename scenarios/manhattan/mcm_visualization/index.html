
<!DOCTYPE html>
<html>
<head>
    <title>Frenet Path Visualizer</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        #visualizer { width: 100%; height: 100vh; }
        .vehicle { position: absolute; width: 20px; height: 10px; border-radius: 3px; }
        .path { position: absolute; height: 2px; border-radius: 1px; }
        .planned-path { background-color: rgba(0, 100, 255, 0.7); }
        .desired-path { background-color: rgba(255, 50, 50, 0.7); border-style: dashed; }
        .controls { position: fixed; top: 10px; right: 10px; background: rgba(255,255,255,0.8); padding: 10px; }
    </style>
</head>
<body>
    <div id="visualizer"></div>
    <div class="controls">
        <label>スケール: <input type="range" id="scale" min="1" max="20" value="10"></label>
        <div>
            <span style="background-color: rgba(0, 100, 255, 0.7); display: inline-block; width: 20px; height: 10px;"></span> 予定経路
            <span style="background-color: rgba(255, 50, 50, 0.7); display: inline-block; width: 20px; height: 10px; margin-left: 10px;"></span> 希望経路
        </div>
    </div>
    
    <script>
        const visualizer = document.getElementById('visualizer');
        const scale = document.getElementById('scale');
        const vehicles = {};
        const SCALE_FACTOR = 10; // メートルをピクセルに変換
        
        // JSONデータを定期的に取得
        function fetchData() {
            fetch('data.json?' + new Date().getTime())
                .then(response => response.json())
                .then(data => {
                    updateVehicles(data);
                    setTimeout(fetchData, 500); // 500ミリ秒ごとに更新
                })
                .catch(err => {
                    console.error('Error fetching data:', err);
                    setTimeout(fetchData, 1000); // エラー時は1秒後に再試行
                });
        }
        
        function updateVehicles(data) {
            const scaleValue = parseInt(scale.value);
            
            for (const vehicleId in data) {
                const vehicleData = data[vehicleId];
                
                // 車両要素を取得または作成
                let vehicle = vehicles[vehicleId];
                if (!vehicle) {
                    vehicle = {
                        element: document.createElement('div'),
                        plannedPath: document.createElement('div'),
                        desiredPath: document.createElement('div'),
                        label: document.createElement('div')
                    };
                    
                    // 車両要素の設定
                    vehicle.element.className = 'vehicle';
                    vehicle.element.style.backgroundColor = '#2ca02c';
                    
                    // パス要素の設定
                    vehicle.plannedPath.className = 'path planned-path';
                    vehicle.desiredPath.className = 'path desired-path';
                    
                    // ラベル設定
                    vehicle.label.style.position = 'absolute';
                    vehicle.label.style.fontSize = '12px';
                    vehicle.label.textContent = vehicleId;
                    
                    visualizer.appendChild(vehicle.element);
                    visualizer.appendChild(vehicle.plannedPath);
                    visualizer.appendChild(vehicle.desiredPath);
                    visualizer.appendChild(vehicle.label);
                    
                    vehicles[vehicleId] = vehicle;
                }
                
                // 車両の位置を更新
                const x = vehicleData.position.x * scaleValue * SCALE_FACTOR;
                const y = vehicleData.position.y * scaleValue * SCALE_FACTOR;
                vehicle.element.style.transform = `translate(${x}px, ${y}px)`;
                
                // ラベルの位置を更新
                vehicle.label.style.transform = `translate(${x}px, ${y - 15}px)`;
                
                // 経路を更新
                if (vehicleData.plannedPath && vehicleData.plannedPath.length > 0) {
                    updatePath(vehicle.plannedPath, vehicleData.plannedPath, scaleValue);
                }
                
                if (vehicleData.desiredPath && vehicleData.desiredPath.length > 0) {
                    updatePath(vehicle.desiredPath, vehicleData.desiredPath, scaleValue);
                }
            }
        }
        
        function updatePath(pathElement, pathData, scaleValue) {
            if (pathData.length < 2) return;
            
            // パスの開始点
            const startX = pathData[0].x * scaleValue * SCALE_FACTOR;
            const startY = pathData[0].y * scaleValue * SCALE_FACTOR;
            
            // パスの終了点
            const endX = pathData[pathData.length - 1].x * scaleValue * SCALE_FACTOR;
            const endY = pathData[pathData.length - 1].y * scaleValue * SCALE_FACTOR;
            
            // 長さと角度を計算
            const length = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
            const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI;
            
            // パスの位置とスタイルを設定
            pathElement.style.width = `${length}px`;
            pathElement.style.transform = `translate(${startX}px, ${startY}px) rotate(${angle}deg)`;
            pathElement.style.transformOrigin = '0 0';
        }
        
        // データの取得を開始
        fetchData();
    </script>
</body>
</html>
        